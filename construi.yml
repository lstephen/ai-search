image: maven:3-jdk-8

environment:
  - JENKINS_URL
  - BUILD_NUMBER
  - COVERALLS_REPO_TOKEN

targets:
  build: mvn -B verify

  analytics:
    - mvn -B test
    - mvn -B jacoco:report coveralls:report

  snapshot:
    files:
      - $GPG_PUBLIC_KEY:/root/.gnupg/public.key
      - $GPG_PRIVATE_KEY:/root/.gnupg/private.key
    run:
      - gpg --import /root/.gnupg/public.key
      - gpg --import --allow-secret-key-import /root/.gnupg/private.key
      - mvn -B deploy

